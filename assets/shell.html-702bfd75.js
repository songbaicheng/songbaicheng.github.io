import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as n,e}from"./app-79290541.js";const t={},l=e(`<h1 id="shell-脚本" tabindex="-1"><a class="header-anchor" href="#shell-脚本" aria-hidden="true">#</a> Shell 脚本</h1><h2 id="定时删除过期日志" tabindex="-1"><a class="header-anchor" href="#定时删除过期日志" aria-hidden="true">#</a> 定时删除过期日志</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ./bin.bash</span>

<span class="token assign-left variable">Log_directory</span><span class="token operator">=</span><span class="token string">&quot;/price/log&quot;</span> ＃ 日志地址
<span class="token assign-left variable">days_to_keep</span><span class="token operator">=</span><span class="token number">7</span> ＃ 保留的天数，即七天前的文件将被删除

<span class="token comment"># 计算七天前的曰期</span>
<span class="token assign-left variable">target_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token variable">$days_to_keep</span> days ago&quot;</span> + %Y-%m-%d<span class="token variable">)</span></span>

<span class="token comment"># 删除七天前日期格式的文件夹</span>
<span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$log_directory</span>&quot;</span> <span class="token parameter variable">-type</span> d <span class="token parameter variable">-name</span> <span class="token string">&quot;????-??-??&quot;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> folder<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable">folder_name</span><span class="token operator">=</span>＄<span class="token punctuation">(</span>basename <span class="token string">&quot;<span class="token variable">$folder</span>&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># 比较文件夹的日期与目标日期</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$folder_name</span> <span class="token operator">&lt;</span> <span class="token variable">$target_date</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;删除文件夹：<span class="token variable">$folder</span>&quot;</span>
        <span class="token function">rm</span> - rf <span class="token string">&quot;＄folder&quot;</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token comment"># 删除七天前的*.1og.* 格式文件</span>
<span class="token function">find</span> <span class="token string">&quot;<span class="token variable">$log_directory</span>&quot;</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&quot;*.1og.*&quot;</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> <span class="token function">file</span><span class="token punctuation">;</span>
    <span class="token assign-left variable">file_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">stat</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;%y&quot;</span> <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d<span class="token string">&#39; &#39;</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>

    <span class="token comment"># 比较文件的日期与目标日期</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$file_date</span> <span class="token operator">&lt;</span> <span class="token variable">$target_date</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;删除文件：<span class="token variable">$file</span>&quot;</span>
        <span class="token function">rm</span> <span class="token string">&quot;<span class="token variable">$file</span>&quot;</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用 cron 来定时运行此脚本，使用 <code>crontab -e</code> 命令编辑当前用户的 cron 任务表，然后添加以下内容：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">0</span> <span class="token number">0</span> * * * /shells/cleanup_logs.sh <span class="token comment"># 将在每天的午夜（00:00）运行脚本</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,5),p=[l];function o(i,c){return a(),n("div",null,p)}const k=s(t,[["render",o],["__file","shell.html.vue"]]);export{k as default};
